<!DOCTYPE html>
<head>
    <title>Vehicle</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel='stylesheet' href="{{ url_for('static', filename='font-awesome/css/font-awesome.min.css')}}">

    <script src="https://cdn.jsdelivr.net/npm/underscore@1.9.1/underscore-min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>

<script>
    var token = '{{ token }}';
    var base_uri = 'http://127.0.0.1:8081/wms/';

    if (token==1) {
        window.location.href = '/login'
    }

     $(document).ready(function() {
        function update_info() {
                $.ajax({
                    url: base_uri + '/rest/vehicles?&sessiontoken=' + token,
                    type: 'GET',
                    dataType: 'json',

                    success: function(response) {
                        var items = response["payload"]["vehicles"];
                        items = _.sortBy(items, ['name']);

                        var tableBody = $('#amr-table');
                        tableBody.empty();

                        items.forEach(function(item) {
                            tableBody.append(
                                '<tr>' +
                                '<td>' + item.name + '</td>' +
                                '<td>' + item.missionid + '</td>' +
                                '<td>' + item.state['mission.info'][2] + '</td>' +
                                '<td>' + item.state['mission.info'][2] + '</td>' +
                                '<td>' + item.action.name + '</td>' +
                                '<td>' + item.state['battery.info'][0] + '</td>' +
                                '<td>' + "  v  " + '</td>' +
                                '<td>' + item.isloaded + '</td>' +
                                '<td>' + item.state['traffic.info'][2] + '</td>' +
                                '</tr>'
                            );
                        });
                    },
                    error: function(request, status, error) {
                        console.log("message: " + request.responseText)
                        console.log("error: " + error);

                        window.location.href = '/login';
                    }
                });
        }
       setInterval(update_info, 1000);
     });
</script>
<body>
    <p></p>
    <aside>
        <div class="mission-card" style="width:100%">
            <div style="text-align: center; margin-top:3%;">
            <!--  table data랑 dark-table 확인필요-->
            <table class="amr-table">
                <tr style="background-color: #A3EBB1; color: #4A4A4A">
                    <th>AMR</th>
                    <th>미션코드</th>
                    <th>출발지</th>
                    <th>도착지</th>
                    <th>현재액션</th>
                    <th>배터리</th>
                    <th>Sim</th>
                    <th>적재</th>
                    <th>상태</th>
                </tr>
                <tbody id="amr-table">
                    <!-- Ajax Data -->
                </tbody>
            </table>
            <!--- <p style="background-color: gray; margin-bottom:5%;">새로고침 &nbsp&nbsp 모두정지</p> -->

            <p>&nbsp</p><p>&nbsp</p>
            <form action='vehicle' method='post'>
              <select name="node" class="select-basic" style="width: 200px;">
                  <option value='Charger_01' selected>Charger_01</option>
                  <option value='Charger_02'>Charger_02</option>
                  <option value='Charger_03'>Charger_03</option>
                  <option value='Charger_04'>Charger_04</option>
              </select>
              <select name="vehicle" class="select-basic" style="width: 250px;">
                  <option value='AMR_01' selected>AMR_01</option>
                  <option value='AMR_02'>AMR_02</option>
                  <option value='AMR_03(m)'>AMR_03(m)</option>
                  <option value='AMR_04'>AMR_04</option>
              </select>
              <button type="submit" class='btn btn-outline-light' style="margin: 1%;" method='post'>
                  insert
              </button>
              <button type="submit" class='btn btn-light' style="margin: 0%;" method='post'>
                  extract
              </button>
            </form>
           </div>
          </div>
        </div>
    </aside>


    <div id="nav-bar">
        <ul class="nav-bar">
            <li><a href="/alarm"> <i class="fa fa-exclamation-circle" aria-hidden="true"></i> 알람</a></li>
            <li><a href="/new-mission"> <i class="fa fa-paper-plane" aria-hidden="true"></i> 미션생성</a></li>
            <li><a href="#"> <i class="fa fa-list" aria-hidden="true"></i> 미션목록</a></li>
            <li><a href="/vehicle"> <i class="fa fa-car" aria-hidden="true"></i> 차량</a></li>
            <li><a href="/data"> <i class="fa fa-bars" aria-hidden="true"></i> 메뉴</a></li>
        </ul>
    </div>
</body>
</html>